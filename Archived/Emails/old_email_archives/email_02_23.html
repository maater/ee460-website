<!-- commenting the email tags out .... 
From patt@login.hps.utexas.edu  Wed Feb 23 02:23:19 2011
Return-Path: <patt@login.hps.utexas.edu>
Received: from login.hps.utexas.edu (login.hps.utexas.edu [128.83.178.4])
	by ego.hps.utexas.edu (8.13.8/8.13.8) with ESMTP id p1N8NIf2028046;
	Wed, 23 Feb 2011 02:23:18 -0600
Received: from login.hps.utexas.edu (localhost.localdomain [127.0.0.1])
	by login.hps.utexas.edu (8.13.8/8.13.8) with ESMTP id p1N8NHNH018037;
	Wed, 23 Feb 2011 02:23:17 -0600
Received: (from patt@localhost)
	by login.hps.utexas.edu (8.13.8/8.13.8/Submit) id p1N8NH2R018035;
	Wed, 23 Feb 2011 02:23:17 -0600
Date: Wed, 23 Feb 2011 02:23:16 -0600
From: "Yale N. Patt" <patt@ece.utexas.edu>
To: miladhashemi@gmail.com, faruk@hps.utexas.edu, yuhao.zhu@mail.utexas.edu
Subject: Re: control store and microinstruciton
End comment here .... --> 
<HTML>
<HEAD>
<TITLE>EE 460N: Email Wed, 23 Feb 2011, 02:23</TITLE>
</HEAD>
<BODY TEXT="black" BGCOLOR="white" LINK="green" VLINK="purple" ALINK="#0000EE">
<H1></H1>
<p><font size=+1>Wed, 23 Feb 2011, 02:23</font>
<p><pre>
<font color="blue">
If you have read and understood Appendix C, then you can probably safely
delete this message and move on.  For those having trouble, a student writes:
<font color="black">
&gt; Dr. Patt,
&gt; 
&gt; Referring to Figure C.4 in APPENDIX C, during any particular state
&gt; - does the 6-bit value produced by the microsequencer indicate the 
&gt; current state?
</font>

No.  The 6-bit value produced by the microsequencer is the address of the
microinstruction that will be active during the NEXT cycle.    
<font color="black">
&gt; - does the top 9-bit of the microinstruction indicate the next state?
</font>

No.  The "top" (left) 9 bits of the microinstruction are used by the 
microsequencer to figure out the address of the microinstruction that will
be active in the NEXT cycle.
<font color="black">
&gt; - is the low 26-bit of microinstruction the signals that is going to be 
&gt; used during the current state?
</font>

Almost.  The low 26 bits and the high 9 bits are ALL used during the CURRENT
cycle.
<font color="black">
&gt; If my understanding is correct, why is there a latch for microinstruction 
&gt; in PL2, since we are using the signals as soon as we get them?
&gt; If instead the low-26 bit for the next state, it looks like the control 
&gt; store will have no way to determine what control signals to produce, since 
&gt; what the next state will be is not clear yet.
</font>

I am having trouble understanding your question.  Perhaps I should start by
explaining what is going on.  This is all spelled out in Appendix C.  I would
be interested in knowing what you found confusing in the text of Appendix C.

Now, then: Each cycle, the microarchitecture is processing one state of the
state machine.  Two things must be done in a cycle, as shown on the state 
machine (Figure C.2): the processing during the cycle, and the figuring out
which state comes next.

Let's look at an example.  Say, state #2.  Let's assume at the end of the
LAST clock cycle, the microinstruction corresponding to state #2 was latched
into the microinstruction register.  At the start of the CURRENT clock cycle
therefore, there are 35 control signals.  The 26 control signals on the right
control the processing in the data path.  The state machine specifies that
processing.  Inside state #2, you note MAR &lt;- B + off6.  The 26 control signals
make that happen.  The 9 signals on the left are input to the microsequencer
which has to figure out what state comes next.  In this case, state #29.  So,
during the current cycle, while 26 control signals are performing  
MAR &lt;- B + off6, 9 signals are emabling the microsequencer to generate the
control store address 011101 (i.e., #29) so that at the end of the CURRENT
clock cycle, the microinstruction corresponding to state #29 can be loaded 
into the microinstruction register.

The job of the microsequencer for state #2 is easy.  There is only one arrow
out of state #2, which means an unconditional microbranch.  The address is
011101, which is the J field.  The COND field specifies 00, indicating that
there is only one arrow, i.e., no choice.  The IRD field is 0, indicating
we are not using opcode bits to determine what to do next.  With these 9 bits,
the output of the microsequencer is 011101, which is sent to the control store
ROM which contains the microinstruction for state #29.  At the end of the
CURRENT cycle, that microinstruction is latched into the microinstruction
register.

In the next cycle, the microinstruction corresponding to state #29 is active.
That means 26 control signals perform MDR &lt;- M[MAR[15:1]'0], and 9 bits
are used by the microsequencer to determine whether the next state is #29 or
#31.  The arrows from state #29 clearly show that if R=0, the next state is
#29, and if R=1, the next state is #31.  To enable that to happen, the J field
must be 011101, COND must be 01 and IRD must be 0.  With those values, Figure
C.5 shows that the output of the microsequencer will be 011101 if R=0 and 
011111 if R=1.  This address is sent to the control store rom so that at the
end of the clock cycle, the microinstruction corresponding to state #29 or #31
will be latched into the microinstruction register.

Note that in every cycle, two separate pieces of work are going on - the
data path is processing based on the 26 control signals and the microsequencer
is processing based on the 9 control signals.  At the end of the cycle, all
values produced in the data path are latched so as to be available in the next
clock cycle and the microinstruction for the next clock cycle is latched in the
microinstruction register.

Good luck finishing the lab by Sunday night.

Yale Patt

</font>
</pre>
</body>
</html>
