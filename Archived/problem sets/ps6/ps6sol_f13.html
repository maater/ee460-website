<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>EE 460N: Problem Set 5 Solution</title>
<link rel="StyleSheet" type="text/css" href="../../main.css" />
<link rel="StyleSheet" type="text/css" href="../probs.css" />
</head>
<body>
<center>
<h2>
Department of Electrical and Computer Engineering</h2></center>

<center>
<h3>The University of Texas at Austin</h3></center>
EE 460N, Fall 2013
<br />Problem Set 5 Solution
<br />Aater Suleman, Instructor
<br />Stephen Pruett, Abhishek Agarwal, Chirag Sakhuja, TAs
<ol class="questions">

<li><!-- Begin Question -->
<p>The state diagram for the FSM device controller can be found in the
handouts section of the website under the notes for I/O.  Note that in the
notes, the transition from BGout to IDLE is based on the SACK signal.  This is
to illustrate the second race condition which is corrected by basing the
transition on (NOT BGin).</p>
<!--<img src="ps3q1x.gif" alt="The device controller state diagram" />-->
<p>The input and output signals of the controller are:</p>
<table>
<thead>
<tr><th>Signal</th><th>Type</th><th>Function</th></tr>
</thead>
<tbody>
<tr>
<td>DEV</td><td>Input</td>
<td>Asserted when the device needs to initiate a bus transaction</td>
</tr>
<tr>
<td>BG<sub>in</sub></td><td>Input</td>
<td>Incoming bus grant signal, asserted by the priority arbitration unit</td>
</tr>
<tr>
<td>BBSY<sub>in</sub></td><td>Input</td>
<td>Asserted by the current bus master. Negative edge indicates the end of a bus cycle.</td>
</tr>
<tr>
<td>MSYN</td><td>Input</td>
<td>Master-side handshaking signal that controls the bus transaction between the bus master and the slave</td>
</tr>
<tr>
<td>SSYN</td><td>Input</td>
<td>Slave-side handshaking signal that controls the bus transaction between the bus master and the slave</td>
</tr>
<tr>
<td>BR<sub>out</sub></td><td>Output</td>
<td>Asserted to request the bus. Goes to the priority arbitration unit.</td>
</tr>
<tr>
<td>SACK</td><td>Output</td>
<td>Asserted by the device that has won the arbitration</td>
</tr>
<tr>
<td>BBSY<sub>out</sub></td><td>Output</td>
<td>Same as BBSY<sub>in</sub></td>
</tr>
<tr>
<td>BG<sub>out</sub></td><td>Output</td>
<td>Asserted when the controller needs to pass the bus grant signal down the daisy chain.</td>
</tr>
</tbody>
</table>

<p>Two race conditions are:</p>
<ol>
<li>
<p>This race condition is subtle. From the PAU side the PAU asserts BGj, which
works its way down the daisy chain to all devices at BRj. Before SACK is
asserted, a controller asserts BRk, where k is higher priority than j. PAU now
asserts BGk, and you have two BG signals propagating, which will result in two
controllers thinking they are the next bus master.</p>

<p>Solution: PAU latches BR signals when it sees NOT-BBSY, indicating it is
okay to grant the bus again. NOT-SACK is also gated (after sufficient delay)
with the BG signals, guaranteeing that a BG signal cannot be asserted until
after PAU logic has taken effect. Any subsequent BR signal does not get latched
and so can not affect the PAU logic.</p>
</li> 

<li>
<p>Let's say device controller D1 is in BG<sub>out</sub> state. This means that
some device D2 that is down the same daisy chain as D1 had requested and is
granted the bus. Let's say the device of D1 asserts the DEV signal while D1 is
in BG<sub>out</sub> state. D2 will eventually receive the BG<sub>in</sub>
signal and transition to the SACK state. It will take some time for the SACK
signal to travel to the priority arbitration unit. The SACK signal probably
reaches D1 before it reaches the priority arbitration unit. Hence, when the
SACK signal reaches D1 the BG<sub>in</sub> input of D1 is still being asserted.
Therefore, upon receiving the SACK signal D1 will immediately transition to
IDLE to BR<sub>out</sub> to SACK states. Hence, both D1 and D2 will be
asserting the SACK signal which is not desirable. A simple solution that fixes
this race condition is not transitioning to IDLE state if the BG<sub>in</sub>
signal is still high.</p>
</li>

</ol>
</li><!-- End of Question -->

<li><!-- Begin Question -->
<ol type="a">
<li>
<p>The solution is shown below:</p>
<img src="prob5a.jpg" alt="The bus logic diagram" />
</li>
<li>
<p>It is possible. Consider a case where device 3 and 4 just alternate the bus.</p>
</li>
<li>
<p>The solution is shown below.</p>
<img src="prob5c-new.jpg" alt="The device controller state machine" /> 
</li>
</ol>
</li><!-- End of Question -->

<li><!-- Begin Question -->

<p>a) Single processor system - using Horner's rule
<p>(((((ax + b)x + c)x + d)x + e)x + f)x + g
<p>Number of operations = 12 (6 multiplies & 6 adds)
<p>Number of time-steps = 12
<p>
<p>b) Using 4 processors: time steps = 5, operations = 15.
<p>One way of doing this is:

<center><table BORDER COLS=5 WIDTH="100%" NOSAVE >
<tr ALIGN=CENTER NOSAVE>
<td NOSAVE>Step 1</td>

<td>x * x</td>

<td>b * x</td>

<td>d * x</td>

<td>f * x</td>
</tr>

<tr ALIGN=CENTER NOSAVE>
<td NOSAVE>Step 2</td>

<td>x<sup>2</sup> * x<sup>2</sup></td>

<td>a * x<sup>2</sup></td>

<td>dx + e</td>

<td>bx + c</td>
</tr>

<tr ALIGN=CENTER NOSAVE>
<td NOSAVE>Step 3</td>

<td>ax<sup>2</sup> * x<sup>4</sup></td>

<td>(bx +c) * x<sup>4</sup></td>

<td>(dx +&nbsp;e) * x<sup>2</sup></td>

<td>fx + g</td>
</tr>

<tr ALIGN=CENTER NOSAVE>
<td NOSAVE>Step 4</td>

<td>ax<sup>6</sup> + bx<sup>5 </sup>+ cx<sup>4</sup></td>

<td>dx<sup>3</sup> + ex<sup>2 </sup>+ fx + g</td>

<td> </td>

<td> </td>
</tr>

<tr ALIGN=CENTER NOSAVE>
<td NOSAVE>Step 5</td>

<td>ax<sup>6</sup> + bx<sup>5 </sup>+ cx<sup>4</sup> + dx<sup>3</sup> +
ex<sup>2 </sup>+ fx + g</td>

<td> </td>

<td> </td>

<td> </td>
</tr>
</table></center>

<p>An intuitive proof for why it can't be done in less than 5 time
steps: <p>Lets assume it takes x time steps. In the xth time step,
only one operation can be performed (either an add or a multiply) to
get the final result. In the (x-1)th time step, at the most two
operations can be performed, one each to get each of the operands for
the operation in step x. In the (x-2)nd time step & other below,
possibly 4 units of work can be found. If x = 4, then theres no way to
compute all the operands such that only 3 operations are left to be
performed after 2 time steps.
<p>
c)&nbsp;&nbsp;Speedup = T<sub>1</sub>/ T<sub>p</sub> = 12/5 = 2.4
<p>
</li><!-- End of Question -->


</ol>
</html>
