<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>EE 460N: Problem Set 2 Solution</title>
<link rel="StyleSheet" type="text/css" href="../../main.css" />
<link rel="StyleSheet" type="text/css" href="../probs.css" />
</head>
<body>

<center>
<h2>
Department of Electrical and Computer Engineering</h2></center>

<center>
<h3>
The University of Texas at Austin</h3></center>
<br />Problem Set 2 Solutions
<ol class="questions">

<li><p>
The ISA is the contract between the hardware and the software. The microarchitecture is a particular implementation of an ISA. 
Compiler does not need to know any information about the microarchitecture.</p>
  <ol>
  <li>ISA</li>
  <li>Microarchitecture</li>
  <li>ISA</li>
  <li>Microarchitecture</li>
  <li>ISA</li>
  <li>Microarchitecture/ISA</li>
  <li>ISA</li>
  <li>Microarchitecture</li>
  <li>Microarchitecture</li>
  <li>Microarchitecture</li>
</ol>
</li>
<li>
<ol>
<li>The first option does not support either subroutine nesting or subroutine recursion.</li>
<li>The second option supports subroutine nesting, but does not support recursion.</li>
<li>The third option supports both subroutine nesting and subroutine recursion.</li>
</ol>
</li>
<li>
<ol>
<li>Little endian: <span class="equation">MEM[<code>x1000</code>] + MEM[<code>x1002</code>] = <code>x1A0E</code> + <code>x0C11</code> = <code>x261F</code></span></li>
<li>Big endian:    <span class="equation">MEM[<code>x1000</code>] + MEM[<code>x1002</code>] = <code>x0E1A</code> + <code>x110C</code> = <code>x1F26</code></span></li>
</ol>
</li>

<li> <!-- Begin Question -->
<ol>
<li><p>The comments indicate the number of cycles each instruction takes:</p>
<pre><code>        .ORIG X3000
AND R0, R0, #0    ; 9 cycles
        LEA R3, NUM       ; 9 cycles
        LDW R3, R3, #0    ; 15 cycles
        LDW R1, R3, #0    ; 15 cycles
        ADD R2, R1, #0    ; 9 cycles
LOOP    ADD R0, R0, R1    ; 9 cycles
        ADD R2, R2, #-1   ; 9 cycles
        BRP LOOP          ; 10 cycles for Taken / 9 for Not Taken
        STW R0, R3, #1    ; 15 cycles
        HALT              ; 35 cycles
NUM     .FILL x4000
        .END</code></pre>
</li> 
<li><p>To calculate the square of <var>k</var>, the inner loop gets executed <var>k</var> times. The branch 
is taken (<var>k</var>-1) times and not taken one time.</p>
<span class="equation">Number of cycles = 9 + 9 + 15 + 15 + 9 + (k-1)*(9 + 9 + 10) + 1*(9 + 9 + 9) + 15 + 35 = 28k + 106</span>
</li>
<li><span class="equation"><var>k</var> = 255</span></li>
<li><p>After we load the value of <var>k</var>, check if it is negative. If so, take the 2&apos;s 
complement before entering the loop.</p>
</li> 
<li><p><var>k</var> can range from -255 to +255</p></li>
</ol>
</li>	
<!-- End Question -->

<li> <!-- Begin Question -->
<ol>
<li><p>State 32. We can get rid of the LD_BEN signal altogether and always load enable 
the BEN register.</p></li>
<li><p>The value that is loaded into BEN in state 32 could instead be calculated in 
state 0, but this would add delay for calculating the next state and would probably 
force the cycle time to be increased.</p></li>
<li>
<pre><code>A = IR[15:12]
B = IR[11]&amp;N + IR[10]&amp;Z + IR[9]&amp;P  (i.e., the old BEN signal)</code></pre>
</li>
</ol>
</li>
<!-- End Question -->

<li> <!-- Begin Question -->
<ol>
<li><p>Filled in state sequence:</p>
<img alt="Additional state sequence for the new ADDM instruction" src="addm_state_sol.gif" />
<p>
There are many possible state numberings, but state numbers must be chosen from 24, 34, and 36-63.  
The state number for <var>C</var> must differ from the state number for <var>B</var> only in the bit1 position, and bit1 
must be 0 for state <var>B</var>.  For example, if state <var>B</var> is 36 (100100), state <var>C</var> must be 38 (100110).  
The one-bit signal <var>X</var> is the Ready bit (R) from memory.</p>
</li>
<li><p>We need a 16-bit temporary register (T) which gets its inputs from the system bus. We need a 
signal LD.T (extra control signal 1) to control when to load this register. This register 
holds the data that is fetched from memory. We also need a mux in front of the A input of the 
ALU. This mux should select between SR1 and the output of the temporary register. We need a 
control signal for the select line of this mux (ALUMX2 - extra control signal 2).</p>
  <br />
  ALUMX2 = 0 selects SR1
  <br />
  ALUMX2 = 1 selects T
</li>
<li><p>Filled in microinstructions:</p>
<img alt="Filled in microinstructions for the new ADDM instruction" src="addm_ctrl2_sol.gif" />
<p>All other signals are 0.  The J bits will depend on the state numbering chosen in part (a).  The J bits 
for states <var>A</var> and <var>B</var> must correspond to the state number for <var>B</var>, the J bits for state <var>C</var> must correspond 
to the state number for <var>D</var>, and the J bits for <var>D</var> must be 18 (010010). The bit encodings for control signals are the same as
specified in Lab 3.</p>
</li>
</ol>
</li> 

<li><p>Truth table for the WE Logic:</p>
<table>
<thead>
<tr><th>MAR[0]</th><th>R.W</th><th>DATA.SIZE</th><th>WE1</th><th>WE0</th></tr>
</thead>
<tbody>
<tr><td>0</td><td>RD</td><td>Byte</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>RD</td><td>Word</td><td>0</td><td>0</td></tr>
<tr><td>0</td><td>WR</td><td>Byte</td><td>0</td><td>1</td></tr>
<tr><td>0</td><td>WR</td><td>Word</td><td>1</td><td>1</td></tr>
<tr><td>1</td><td>RD</td><td>Byte</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>RD</td><td>Word</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>WR</td><td>Byte</td><td>1</td><td>0</td></tr>
<tr><td>1</td><td>WR</td><td>Word</td><td>0</td><td>0</td></tr>
</tbody>
</table>
<pre><code>RD = 0  WR = 1;  Byte = 0  Word = 1
WE0 = (MAR[0]') AND (R.W)
WE1 = R.W AND (MAR[0] XOR DATA.SIZE)</code></pre>
</li>
 <!-- End Question -->

<li><!-- Begin Question -->
<p>Truth table for the Address Control Logic:</p>
<table>
<thead>
<tr><th>MIO.EN</th><th>R.W</th><th>MAR</th>
<th>MEM.EN</th><th>INMUX</th><th>LD.KBSR</th><th>LD.DSR</th><th>LD.DDR</th></tr>
</thead>
<tbody>
<tr><td>0</td><td>X</td><td>X</td>
<td>0</td><td>X</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>R</td><td><code>xFE00</code></td>
<td>0</td><td>KBSR</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>R</td><td><code>xFE02</code></td>
<td>0</td><td>KBDR</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>R</td><td><code>xFE04</code></td>
<td>0</td><td>DSR</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>R</td><td><code>xFE06</code></td>
<td>0</td><td>X</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>R</td><td>OTHER</td>
<td>1</td><td>MEMORY</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>W</td><td><code>xFE00</code></td>
<td>0</td><td>X</td><td>1</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>W</td><td><code>xFE02</code></td>
<td>0</td><td>X</td><td>0</td><td>0</td><td>0</td></tr>
<tr><td>1</td><td>W</td><td><code>xFE04</code></td>
<td>0</td><td>X</td><td>0</td><td>1</td><td>0</td></tr>
<tr><td>1</td><td>W</td><td><code>xFE06</code></td>
<td>0</td><td>X</td><td>0</td><td>0</td><td>1</td></tr>
<tr><td>1</td><td>W</td><td>OTHER</td>
<td>1</td><td>X</td><td>0</td><td>0</td><td>0</td></tr>
</tbody>
</table>
</li>
 <!-- End Question -->

<li>
<ol>
Postponed
</ol>
</li>

<li>
<ol>
Postponed
</ol>
</li>

<li>
<p>In the wrong version, instructions <code>JSR R7</code> and <code>JSRR R7</code> would execute incorrectly. Their base register (R7) would be overwritten with the value of the PC in state 4. Thus, the addresses generated in states 20 and 21 would come out wrong.</p>
</li>

<li>
<ol>
<li><p>We cannot tell the size of the MAR, since it depends on the number of
memory locations and does not depend on the addressability (the number of bits
in each location). For the MDR, first consider the LC3b. The LC3b is Byte (8
bit) addressable with an MDR size of 16 bits. We cannot tell the size of the
MDR based on addressability either.</p></li>
<li><p>Each register (DR, SR1, and SR2) would have to be specified with five bits. With the steering bit, the total number of bits used would be 16 &ndash; leaving no bits for the opcode.</p></li>
</ol>
</li>

<li><!-- Begin Question -->
<p>Assume an ADD operation is executed like this in the pipeline:</p>
<table class="pipeline">
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th></tr>
<tr><td>F</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td></tr>
</table>
<p>and a MUL operation is executed like this in the pipeline:</p>
<table class="pipeline">
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th></tr>
<tr><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td></tr>
</table>
<p>
F: Fetch, D: Decode, A: Execute stage (for ADD), M: Execute stage for MUL, S: Store result (Write-back)</p>
<ol>
<li>ADDs require 7 cycles (fetch, decode, 4 execute, store), and MULs require 9 cycles (fetch, decode, 6 execute, store). For
 3 ADD instructions and 3 MUL instructions, the execution time is <span class="equation">3 &times; 7 + 3 &times; 9 = <span class="answer">48</span></span> cycles.</li>
<li>Pipeline with scoreboarding and five adders and five multipliers (assuming one instruction fetched per cycle):
<ol>
<li>No data forwarding: the destination register is marked valid in the S stage
(a dependent instruction starts executing after the S stage of the instruction it depends on)
<table class="pipeline">
<thead>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th><th>22</th><th>23</th><th>24</th><th>25</th><th>26</th></tr>
</thead>
<tbody>
<tr><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td></tr>
</tbody>
</table>
<p>Execution time: <span class="answer">26 cycles</span></p>
</li>
<li>With forwarding:
<table class="pipeline">
<thead>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th><th>22</th><th>23</th><th>24</th></tr>
</thead>
<tbody>
<tr><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td></tr>
</tbody>
</table>
<p>Execution time: <span class="answer">24 cycles</span></p>
</li>
</ol>
</li>
<li>
<p>Pipeline with scoreboarding and one adder and one multiplier (assuming one instruction fetched per cycle):</p>
<ol>
<li>
<p>The adder and multiplier are not pipelined and there is no data forwarding:</p>
<table class="pipeline">
<thead>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th><th>22</th><th>23</th><th>24</th><th>25</th><th>26</th><th>27</th><th>28</th><th>29</th></tr>
</thead>
<tbody>
<tr><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td></tr>
</tbody>
</table>
<p>Execution time: <span class="answer">29 cycles</span></p>
</li>
<li>
<p>The adder and multiplier are not pipelined and there is data forwarding:</p>
<table class="pipeline">
<thead>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th><th>22</th><th>23</th><th>24</th><th>25</th><th>26</th><th>27</th></tr>
</thead>
<tbody>
<tr><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td></tr>
</tbody>
</table>
<p>Execution time: <span class="answer">27 cycles</span></p>
</li>
<li>
<p>The adder and multiplier are pipelined and there is no data forwarding:</p>
<table class="pipeline">
<thead>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th><th>22</th><th>23</th><th>24</th><th>25</th><th>26</th></tr>
</thead>
<tbody>
<tr><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td></tr>
</tbody>
</table>
<p>Execution time: <span class="answer">26 cycles</span></p>
</li>
<li>
<p>The adder and multiplier are pipelined and there is data forwarding:</p>
<table class="pipeline">
<thead>
<tr><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th><th>22</th><th>23</th><th>24</th></tr>
</thead>
<tbody>
<tr><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>D</td><td>A</td><td>A</td><td>A</td><td>A</td><td>S</td><td></td><td></td><td></td></tr>
<tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td><td>D</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>M</td><td>S</td></tr>
</tbody>
</table>
<p>Execution time: <span class="answer">24 cycles</span></p>
</li>
</ol>
</li>
</ol>
</li><!-- End Question -->

<!-- Begin Question -->
<li>Assumptions:
<ul>
<li>There are enough ports to the register file.</li>

<li>There are enough ports to the memory.</li>

<li>There are separate execution units for ADD, AND, STW, and BR
instructions (They can all be in the execute stage at the same time.)</li>
</ul>
<ol>
<li><p>Pipeline diagram:</p>
<table class="pipeline">
<thead>
<tr><th>Instruction</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th></tr>
</thead>
<tbody>
<tr><td colspan="16" class="comment">Start of first iteration (R1 is even)</td></tr>
<tr><td class="instr">STW</td><td>F</td><td>D</td><td>E</td><td>E</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">ADD</td><td></td><td>F</td><td>D</td><td>E</td><td>E</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">AND</td><td></td><td></td><td>F</td><td>D</td><td>E</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">BRz</td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">ADD</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>E</td><td>E</td><td>E</td><td>S</td><td></td><td></td></tr>
<tr><td class="instr">ADD</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>E</td><td>E</td><td>E</td><td>S</td><td></td></tr>
<tr><td class="instr">BRp</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>E</td><td>S</td></tr>
<tr><td colspan="16" class="comment">End of the first iteration (R1 is odd now)</td></tr>
<tr><td class="instr">STW</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td></tr>
</tbody>
</table>
<p>
The loop takes the same number of cycles to execute for even and odd values of R1. Each iteration takes 14 cycles
in the steady state. There are 5 iterations for even values of R1 and 4 iterations for odd values of
R1. The total number of cycles is:</p>
<div class="equation">
(14 &times; 5) + (14 &times; 4) + 1 = <span class="answer">127</span>
</div>
<p>The extra 1 cycle comes from the last iteration (Store result stage of the BRp instruction).</p>
</li>
<li><p>Pipeline diagram:</p>
<table class="pipeline">
<thead>
<tr><th>Instruction</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>16</th></tr>
</thead>
<tbody>
<tr><td colspan="17" class="comment">Start of first iteration (R1 is even)</td></tr>
<tr><td class="instr">STW</td><td>F</td><td>D</td><td>E</td><td>E</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">ADD</td><td></td><td>F</td><td>D</td><td>E</td><td>E</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">AND</td><td></td><td></td><td>F</td><td>D</td><td>E</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">BRz</td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">ADD</td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>D</td><td>E</td><td>E</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">ADD</td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>E</td><td>E</td><td>E</td><td>S</td><td></td><td></td><td></td><td></td></tr>
<tr><td class="instr">BRp</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>D</td><td>D</td><td>D</td><td>E</td><td>S</td><td></td><td></td><td></td></tr>
<tr><td colspan="17" class="comment">End of the first iteration (R1 is odd now)</td></tr>
<tr><td class="instr">STW</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>F</td><td>F</td><td>F</td><td>D</td><td>E</td><td>E</td><td>E</td><td>S</td></tr>
</tbody>
</table>
<p>The loop takes the same number of cycles to execute for even and odd values of R1. Each iteration takes 13 cycles
but 3 cycles can be overlapped with the next iteration. 
The total number of cycles is:</p>
<div class="equation">
  (10 &times; 9) + 3 = <span class="answer">93</span>
</div>

</li>

<li><p>BRz instruction will always be predicted not taken. It is taken
when R1 is even. So it will be mispredicted when R1 is even and
correctly predicted when R1 is odd. The following diagram shows three
consecutive iterations of the loop. In the first iteration, BRz is
mispredicted, in the second iteration it is correctly predicted.</p>
<p>The first BRp instruction is always predicted taken. It is always
predicted correctly. The second BRp instruction is also always
predicted taken. It is mispredicted only once in the last iteration of
the loop.</p>

<pre style="font-size: smaller">
        1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33    
-------------------------------------------------------------------------------------------------------------- Start of first iteration (R1 is even)
STW     F | D | E | E | E | S
ADD         F | D | E | E | E | S
AND             F | D | E | E | S
BRz                 F | D | D | E | S  (Mispredicted)
ADD R1, R1, #3          F | F | D | Flushed
ADD R5, R5, #-1                 F | Flushed
ADD R1, R1, #1                      F | D | E | E | E | S
ADD R7, R7, #-1                         F | D | E | E | E | S
BRp DOIT                                    F | D | D | D | E | S (Correctly predicted)
------------------------------------------------------------------------------------------------------------- Start of second iteration (R1 is odd)
STW                                             F | F | F | D | E | E | E | S
ADD                                                         F | D | E | E | E | S
AND                                                             F | D | E | E | S
BRz                                                                 F | D | D | E | S (Correctly predicted)
ADD R1, R1, #3                                                          F | F | D | E | E | E | S
ADD R5, R5, #-1                                                                 F | D | E | E | E | S
BRp DOIT                                                                            F | D | D | D | E | S (Correctly predicted)
------------------------------------------------------------------------------------------------------------ Third iteration (R1 is even)
STW                                                                                     F | F | F | D | E | E | S 
ADD                                                                                                 F | D | E | E | E | S
AND                                                                                                     F | D | E | E | S
BRz                                                                                                         F | D | D | E | S  (Mispredicted)
ADD R1, R1, #3                                                                                                  F | F | D | Flushed
ADD R5, R5, #-1                                                                                                         F | Flushed
ADD R1, R1, #1                                                                                                              F | D | E | E | E | S
ADD R7, R7, #-1                                                                                                                 F | D | E | E | E | S
BRp DOIT                                                                                                                            F | D | D | D | E | S (Correctly predicted)
        &lt;--------- beginning of the loop ----&gt;&lt;------------------------ steady state (22 cycles) ------------------------------------&gt;
</pre>

<p>Loop steady state is shown above. It takes 22 cycles and it is
repeated 4 times. The beginning of the loop (until the steady state)
takes 10 cycles as shown above. The end of the loop (part of the last
iteration which is not in steady state) takes 5 more cycles to
execute. The total number of cycles is:</p>
<div class="equation">
  10 + (4 &times; 22) + 5 = <span class="answer">103</span>
</div>

<p>Prediction accuracies for each branch are:</p>

<ul>
  <li>BRz  = 4/9 (Correctly predicted when R1 is odd, R1 is odd for 4 iterations of the loop)</li>
  <li>first BRp  = 4/4</li>
  <li>second BRp = 4/5 (Mispredicted only in the last iteration - Note
  that this misprediction does not affect the number of cycles it takes
  to execute the loop)</li>
</ul>
<p>Combined branch prediction accuracy = 12/18 = <span class="answer">67%</span></p>
</li>
</ol>
</li><!-- End Question -->


<li><!-- Begin Question -->
<!--
<ol>
  <li><br /><img src="code.jpg" alt="Filled out instruction sequence" /></li>

  <li><br /><img src="tomasulo_sol.jpg" alt="Filled out reservation stations" /></li>

  <li><br /><img src="RAT.jpg" alt="Filled out register alias table" /></li>
</ol>
--!>
</li><!-- End Question -->
<li>
<p>The states could be state nos 20 and 12 when you are loading PC from the register. Although the '0' offset can be acquired from the instruction as well using the least 6 significant bits</p>
</li>


</ol>

</body>
</html>
